<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T2_ExprDiferencial • franciscomartinez</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="T2_ExprDiferencial">
<meta property="og:description" content="franciscomartinez">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">franciscomartinez</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/T1_Microarray.html">T1_Microarray</a>
    </li>
    <li>
      <a href="../articles/T2_ExprDiferencial.html">T2_ExprDiferencial</a>
    </li>
    <li>
      <a href="../articles/T3_RNAseq.html">T3_RNAseq</a>
    </li>
    <li>
      <a href="../articles/T4_Sobrerrepresentacion.html">T4_Sobrerrepresentacion</a>
    </li>
    <li>
      <a href="../articles/T5_GeneSetAnalysis.html">T5_GeneSetAnalysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="T2_ExprDiferencial_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>T2_ExprDiferencial</h1>
                        <h4 class="author">Francisco Martínez Picó</h4>
            
            <h4 class="date">10/05/2020</h4>
      
      
      <div class="hidden name"><code>T2_ExprDiferencial.Rmd</code></div>

    </div>

    
    
<div id="cargando-paquetes" class="section level2">
<h2 class="hasAnchor">
<a href="#cargando-paquetes" class="anchor"></a>Cargando paquetes</h2>
<p>En primer lugar, se cargan los paquetes que se van a utilizar:</p>
<ul>
<li>
<em>Biobase</em>: este paquete para trabajar con Bioconductor contiene estructuras estandarizadas de datos para representar información genómica. Es decir, es necesario para trabajar con ExpressionSet.</li>
<li>
<em>affy</em>: nos permite trabajar y analizar datos obtenidos por Microarrays de Affymetrix.</li>
<li>
<em>genefilter</em>: se utilizará para realizar los t-test por filas.</li>
<li>
<em>limma</em>: paquete utilizado para el análisis de la expresión génica en datos de microarray utilizando modelos lineales.</li>
<li>
<em>ReportingTools</em>: se utiliza para crear el informe con los genes significativos.</li>
<li>
<em>franciscomartinez</em>: para utilizar las funciones que crean las URL a partir de los ID Entrez y Ensembl.</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">Biobase</span>)
<span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">affy</span>)
<span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">genefilter</span>)
<span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">limma</span>)
<span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">ReportingTools</span>)
<span class="kw pkg">pacman</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span>(<span class="no">franciscomartinez</span>)</pre></body></html></div>
</div>
<div id="dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h2>
<p>Seguidamente, se cargarán los datos obtenidos como producto del procesado de la Tarea 1 (T1_Microarray).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">'gse69762'</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'franciscomartinez'</span>)</pre></body></html></div>
<p>Los datos pueden encontrarse en GEO: <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE69762" class="uri">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE69762</a></p>
</div>
<div id="comparación-gen-a-gen-test-de-la-t" class="section level1">
<h1 class="hasAnchor">
<a href="#comparaci%C3%B3n-gen-a-gen-test-de-la-t" class="anchor"></a>Comparación gen a gen: test de la t</h1>
<p>Tenemos datos relativos a la expresión de genes bajo dos condiciones: <strong>pacientes enfermos con una IBD (Enfermedad de Crohn, CD)</strong> y <strong>pacientes sanos control (CONTROL)</strong>. Suponemos una distribución normal de los datos con varianzas iguales (siendo las medias distintas).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">tt</span> <span class="kw">=</span> <span class="kw pkg">genefilter</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/genefilter/man/rowFtests.html">rowttests</a></span>(<span class="no">gse69762</span>, <span class="fu">pData</span>(<span class="no">gse69762</span>)[,<span class="st">'type'</span>])
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">tt</span>)</pre></body></html></div>
<p>Cada una de las filas de ‘tt’ corresponde a un gen. La columna ‘<em>statistic</em>’ muestra el valor del estadístico t del contraste de hipótesis para la igualdad de medias. La segunda columna ‘<em>dm</em>’ muestra la diferencia de medias, mientras que la tercera columna ‘<em>p.value</em>’ muestra el p-valor del contraste de hipótesis.</p>
<p>Se obtiene por tanto un p-valor por cada gen. Observamos cuántos genes se expresarían diferencialmente entre ambos grupos si fijaramos un alpha = 0.05 (siendo alpha la cota de error tipo I, esto es rechazar la hipótesis nula H0 siendo esta cierta).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="no">tt</span>[,<span class="st">'p.value'</span>] <span class="kw">&lt;</span> <span class="fl">0.05</span>)</pre></body></html></div>
<p>Como resultado vemos que 4.862 genes se expresarían diferencialmente entre los pacientes con enfermedad de Crohn (<strong>CD</strong>) y pacientes sanos (<strong>CONTROL</strong>).</p>
<div id="comparaciones-múltiples" class="section level2">
<h2 class="hasAnchor">
<a href="#comparaciones-m%C3%BAltiples" class="anchor"></a>Comparaciones múltiples</h2>
<p>Sin embargo, la metodología anterior está diseñada para hacer uno o unos pocos contrastes de hipótesis, mientras que aquí estamos haciendo miles al trabajar con miles de genes. Esto quiere decir que estamos cometiendo muchos errores de tipo I.</p>
<p>Por lo tanto, cuando estamos llevando a cabo numerosos contrastes de hipótesis se trabaja con <strong>tasas de error</strong>. Son extensiones del único error tipo I que se nos plantea cuando realizamos un solo contraste.</p>
<div id="family-wise-error-rate-fwer" class="section level3">
<h3 class="hasAnchor">
<a href="#family-wise-error-rate-fwer" class="anchor"></a><em>Family Wise Error Rate</em> (<strong>FWER</strong>)</h3>
<p>La tasa FWER se define para tratar de no rechazar una hipótesis nula cuando esta es cierta. Se trata de un criterio muy exigente cuando tenemos un número de contraste de hipótesis muy elevado (como es el caso del análisis de datos ómicos). Consecuentemente, se harán test muy conservadores en los que no se rechazará la hipótesis nula Hi a no ser que la evidencia sea muy grande. Perderemos potencia en los contrastes (donde la potencia es la probabilidad de rechazar la hipotesis nula cuando realmente es falsa).</p>
</div>
<div id="false-discovery-rate-fdr" class="section level3">
<h3 class="hasAnchor">
<a href="#false-discovery-rate-fdr" class="anchor"></a><em>False Discovery Rate</em> (<strong>FDR</strong>)</h3>
<p>Se observó que la tasa FWER era demasiado exigente. La tasa FDR surgió al tratar de conseguir procedimientos más potentes sin que por ello dejaramos de tener una tasa de error razonable controlada. Nos da la proporción de test que hemos rechazado erróneamente. Es decir, esta tasa sería la proporción de hipótesis nulas que son ciertas y que son rechazadas.</p>
</div>
<div id="p-valores-ajustados" class="section level3">
<h3 class="hasAnchor">
<a href="#p-valores-ajustados" class="anchor"></a>p-valores ajustados</h3>
<p>Para cada contraste Hi se tiene un p-valor pi. Cuando consideramos todos los contrastes simultáneamente, los valores de alpha serán distintos para cada contraste (y por ello se debería ir comprobando uno a uno si pi menor o igual a alpha). Por ello, se ajustan todos los p-valores (siendo alpha el valor que especificamos para controlar alguna de las tasas de error tipo I, la tasa de error).</p>
</div>
<div id="método-que-controla-la-fwer-método-de-bonferroni" class="section level3">
<h3 class="hasAnchor">
<a href="#m%C3%A9todo-que-controla-la-fwer-m%C3%A9todo-de-bonferroni" class="anchor"></a>Método que controla la FWER: método de Bonferroni</h3>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">p0</span> <span class="kw">=</span> <span class="no">tt</span>[,<span class="st">'p.value'</span>]
<span class="no">p.bonferroni</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span>(<span class="no">p0</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'bonferroni'</span>)
<span class="no">new_tt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">tt</span>,<span class="no">p.bonferroni</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">new_tt</span>)</pre></body></html></div>
<p>Fijando un alpha de 0.05, vemos que genes son significativos bajo el p-valor ajustado por el método de Bonferroni:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">significativos.bonferroni</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">p.bonferroni</span> <span class="kw">&lt;</span> <span class="fl">0.05</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">new_tt</span>[<span class="no">significativos.bonferroni</span>,])</pre></body></html></div>
<p>¿Cuántos de estos genes eran significativos con el p-valor crudo y cuántos lo son con el p-valor ajustado por el método de Bonferroni?</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">significativos.p0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">p0</span> <span class="kw">&lt;</span> <span class="fl">0.05</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">significativos.p0</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">significativos.bonferroni</span>)</pre></body></html></div>
<p>4.862 genes tenían una expresión diferencial con el p-valor crudo y 7 lo son con el p-valor ajustado con el método de Bonferroni. Se puede comprobar que cuando trabajamos con p-valores ajustados con el método de bonferroni (y por tanto trabajamos con tasas FWER) se rechazan muy pocas hipótesis nulas, es decir, este test es muy conservador.</p>
</div>
<div id="método-que-controla-la-fdr-método-de-benjamini-y-hochberg-bh" class="section level3">
<h3 class="hasAnchor">
<a href="#m%C3%A9todo-que-controla-la-fdr-m%C3%A9todo-de-benjamini-y-hochberg-bh" class="anchor"></a>Método que controla la FDR: método de Benjamini y Hochberg (BH)</h3>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">p0</span> <span class="kw">=</span> <span class="no">tt</span>[,<span class="st">'p.value'</span>]
<span class="no">p.BH</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span>(<span class="no">p0</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">'BH'</span>)
<span class="no">new_tt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">tt</span>, <span class="no">p.bonferroni</span>, <span class="no">p.BH</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">new_tt</span>)</pre></body></html></div>
<p>Fijando un alpha de 0.05, vemos que genes son significativos bajo el p-valor ajustado por el método de BH:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">significativos.BH</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">p.BH</span> <span class="kw">&lt;</span> <span class="fl">0.05</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">new_tt</span>[<span class="no">significativos.BH</span>,])</pre></body></html></div>
<p>¿Cuántos de estos genes eran significativos con el p-valor crudo, cuántos lo eran con el p-valor ajustado por el método de bonferroni, y cuántos lo son con el p-valor ajustado por el método de BH?</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">significativos.p0</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">significativos.bonferroni</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">significativos.BH</span>)</pre></body></html></div>
<p>4.862 genes tenían una expresión diferencial con el p-valor crudo, 7 lo eran con el p-valor ajustado con el método de Bonferroni y, utilizando el p-valor ajustado con el método de Benjamini-Hockberg, 88 de los genes tienen una expresión diferencial significativa.</p>
</div>
</div>
<div id="generando-el-primer-informe" class="section level2">
<h2 class="hasAnchor">
<a href="#generando-el-primer-informe" class="anchor"></a>Generando el primer informe</h2>
<p>Para crear el informe, empezaremos por crear un data frame con la información correspondiente:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">all_genes</span> <span class="kw">=</span> <span class="no">new_tt</span> <span class="co"># Todos los genes (significativos y no significativos).</span>

<span class="no">significative_genes</span> <span class="kw">=</span> <span class="no">new_tt</span>[<span class="no">significativos.BH</span>,] <span class="co"># Sólo los significativos con el p-valor ajustado con BH.</span>

<span class="no">ID</span> <span class="kw">=</span> <span class="fu">fData</span>(<span class="no">gse69762</span>)[<span class="st">'PROBEID'</span>] <span class="co"># Identificador de las sondas correspondientes a genes que pudimos anotar correctamente con nuestro fichero de anotación.</span>

<span class="no">symbol</span> <span class="kw">=</span> <span class="fu">fData</span>(<span class="no">gse69762</span>)[<span class="st">'SYMBOL'</span>] <span class="co"># Símbolo del gen. Su nombre.</span>

<span class="no">entrezID</span> <span class="kw">=</span> <span class="fu">fData</span>(<span class="no">gse69762</span>)[<span class="st">'ENTREZID'</span>] <span class="co"># EntrezID del gen.</span>
<span class="no">entrezID_URL</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">entrezID</span>, <span class="fl">1</span>, <span class="no">getURL_entrez</span>) <span class="co"># Creamos la URL a partir del ID.</span>

<span class="no">ensemblID</span> <span class="kw">=</span> <span class="fu">fData</span>(<span class="no">gse69762</span>)[<span class="st">'ENSEMBL'</span>] <span class="co"># EnsemblID del gen.</span>
<span class="no">ensemblID_URL</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">ensemblID</span>, <span class="fl">1</span>, <span class="no">getURL_ensembl</span>) <span class="co"># Creamos la URL a partir del ID.</span>

<span class="co"># Queremos coger SÓLO aquellos p.values correspondientes a genes que pudimos anotar correctamente. Miramos cuáles son estos genes:</span>
<span class="no">final_tt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">new_tt</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">new_tt</span>)) <span class="co"># El PROBEID en 'new_tt' aparece como los nombres de las filas. Lo ponemos explicítamente como una columna.</span>

<span class="no">positions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">ID</span>[,<span class="st">'PROBEID'</span>], <span class="no">final_tt</span>[,<span class="st">'rownames.new_tt.'</span>]) <span class="co"># Nos quedamos con las posiciones del data.frame con los p.values que corresponden a los genes que tenemos anotados.</span>

<span class="no">gene_pvalues</span> <span class="kw">=</span> <span class="no">final_tt</span>[<span class="no">positions</span>,] <span class="co"># Montamos un data.frame con los p.values de únicamente los genes que tenemos anotados.</span>
<span class="no">gene_pvalues</span>

<span class="co"># Lo que funciona:</span>
<span class="no">df1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">probeid</span> <span class="kw">=</span> <span class="no">ID</span>, <span class="kw">symbol</span> <span class="kw">=</span> <span class="no">symbol</span>, <span class="kw">entrezID</span> <span class="kw">=</span> <span class="no">entrezID_URL</span>, <span class="kw">ensembl</span> <span class="kw">=</span> <span class="no">ensemblID_URL</span>,
                <span class="kw">p.value</span> <span class="kw">=</span> <span class="no">gene_pvalues</span>[,<span class="st">'p.value'</span>], <span class="kw">p.bonferroni</span> <span class="kw">=</span> <span class="no">gene_pvalues</span>[,<span class="st">'p.bonferroni'</span>], <span class="kw">p.BH</span> <span class="kw">=</span> <span class="no">gene_pvalues</span>[,<span class="st">'p.BH'</span>])

<span class="no">columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'probeID'</span>, <span class="st">'symbol'</span>, <span class="st">'entrezID'</span>, <span class="st">'ensembl'</span>, <span class="st">'p.value'</span>, <span class="st">'p.bonferroni'</span>, <span class="st">'p.BH'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">df1</span>) <span class="kw">=</span> <span class="no">columns</span>

<span class="no">df1</span></pre></body></html></div>
<p>Una vez creado el data.frame, elaboramos el informe con la herramienta ReportingTools:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">foutput</span> <span class="kw">=</span> <span class="st">'gse69762_ttest.report'</span>
<span class="no">htmlRep1</span> <span class="kw">=</span> <span class="fu">HTMLReport</span>(<span class="kw">shortName</span> <span class="kw">=</span> <span class="no">foutput</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="no">foutput</span>, <span class="kw">reportDirectory</span> <span class="kw">=</span> <span class="st">'./reports'</span>)
<span class="fu">publish</span>(<span class="no">df1</span>,<span class="no">htmlRep1</span>)
<span class="fu">finish</span>(<span class="no">htmlRep1</span>)</pre></body></html></div>
</div>
</div>
<div id="test-de-la-t-moderado-limma" class="section level1">
<h1 class="hasAnchor">
<a href="#test-de-la-t-moderado-limma" class="anchor"></a>Test de la t moderado (limma)</h1>
<p>Lo que se hace es ajustar un modelo lineal para cada fila de la matriz de expresión considerando que tenemos valores independientes para las distintas muestras</p>
<p>Consideraremos la variable que asigna a cada muestra si pertenece a una <strong>paciente con enfermedad de Crohn (CD)</strong> o a <strong>un paciente sano (CONTROL)</strong>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu">pData</span>(<span class="no">gse69762</span>)[,<span class="st">'type'</span>]</pre></body></html></div>
<p>Determinamos la matriz diseño o matriz de modelo:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">dessign</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(~ <span class="fu">pData</span>(<span class="no">gse69762</span>)[,<span class="st">'type'</span>]) <span class="co"># variable respuesta (se omite, es cada una de las filas de la matriz de expresión) ~ covariable (variable con efecto principal, variable fenotípica).</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dessign</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'intercept'</span>, <span class="st">'type'</span>) <span class="co"># 'intercept' sería ß0 (ordenada en el origen), mientras que 'type' sería ß1.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dessign</span>)</pre></body></html></div>
<div id="modelo-lineal" class="section level2">
<h2 class="hasAnchor">
<a href="#modelo-lineal" class="anchor"></a>Modelo lineal</h2>
<p>Ajustamos los modelos lineales utilizando la función <em>limma::lmFit</em>. Con esta función, para cada una de las filas de nuestra matriz de expresión, se ajusta un modelo lineal con una sola variable predictora (es decir, utilizamos <strong>regresión lineal simple</strong>). De esta forma, la constante es distinta para cada uno de los modelos:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">=</span> <span class="kw pkg">limma</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span>(<span class="no">gse69762</span>,<span class="no">dessign</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">fit</span>$<span class="no">coefficients</span>) <span class="co"># Se puede ver de nuevo ß0 ('intercept') y ß1 ('type').</span></pre></body></html></div>
</div>
<div id="estimación-de-los-errores-estándar" class="section level2">
<h2 class="hasAnchor">
<a href="#estimaci%C3%B3n-de-los-errores-est%C3%A1ndar" class="anchor"></a>Estimación de los errores estándar</h2>
<p>A continuación, se estima el error estándar utilizando para esa estimación un modelo empírico bayesiano ‘<em>empirical-Bayes</em>’. <strong>En esta estimación del error estándar se utiliza información de todos los genes</strong>.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">new_fit</span> <span class="kw">=</span> <span class="kw pkg">limma</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<p>Finalmente, vemos los resultados (ordenados por módulo de <em>t</em>). Las columnas a las que debemos prestar especial atención son <em>t</em>, <em>P.value</em> y <em>adj.P.Val</em>:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">limma_out1</span> <span class="kw">=</span> <span class="kw pkg">limma</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span>(<span class="no">new_fit</span>, <span class="kw">coef</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">adjust</span> <span class="kw">=</span> <span class="st">'bonferroni'</span>, <span class="kw">number</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu">exprs</span>(<span class="no">gse69762</span>))) <span class="co"># Contendrá todos los genes (ya que trabaja sobre la matriz de expresión), incluso aquellos que no fueron anotados con sus correspondientes id Entrez y Ensembl.</span>

<span class="co"># Se visualizan los 10 primeros por defecto. Si queremos visualizar todos, debemos utilizar el parámetro "number = nrow(exprs(gse69762))", que fija el número a mostrar a el número de filas de la matriz de expresión (es decir, todas las filas)</span>

<span class="co"># Omitimos los genes que no hemos podido anotar:</span>
<span class="no">limma_out1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">limma_out1</span>)
<span class="no">limma_out1</span></pre></body></html></div>
<p>Y de nuevo, hacemos lo mismo pero utilizando el método de Benjamini-Hockberg:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">limma_out2</span> <span class="kw">=</span> <span class="kw pkg">limma</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/toptable.html">topTable</a></span>(<span class="no">new_fit</span>, <span class="kw">coef</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">adjust</span> <span class="kw">=</span> <span class="st">'BH'</span>, <span class="kw">number</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu">exprs</span>(<span class="no">gse69762</span>))) <span class="co"># Contendrá todos los genes (ya que trabaja sobre la matriz de expresión), incluso aquellos que no fueron anotados con sus correspondientes id Entrez y Ensembl.</span>

<span class="co"># Omitimos los genes que no hemos podido anotar:</span>
<span class="no">limma_out2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">limma_out2</span>)
<span class="no">limma_out2</span></pre></body></html></div>
<p>Debemos fijarnos en el p-valor ajustado (<em>adj.P.val</em>) por el método de Benjamini-Hockberg.</p>
</div>
<div id="generando-el-segundo-informe" class="section level2">
<h2 class="hasAnchor">
<a href="#generando-el-segundo-informe" class="anchor"></a>Generando el segundo informe</h2>
<p>Construimos el data.frame con la información deseada:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">entrezID</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'ENTREZID'</span>] <span class="co"># Cogemos el EntrezID de los genes y creamos el link a la URL.</span>
<span class="no">entrezID_URL</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">entrezID</span>, <span class="fl">1</span>, <span class="no">getURL_entrez</span>)

<span class="no">ensemblID</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'ENSEMBL'</span>] <span class="co">#  Cogemos el código Ensembl de los genes y creamos el link a la URL.</span>
<span class="no">ensemblID_URL</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">ensemblID</span>, <span class="fl">1</span>, <span class="no">getURL_ensembl</span>)

<span class="no">limma_gene_pvalues</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">PROBEID</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'PROBEID'</span>], <span class="kw">SYMBOL</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'SYMBOL'</span>],
                                <span class="kw">ENTREZID</span> <span class="kw">=</span> <span class="no">entrezID_URL</span>, <span class="kw">ENSEMBL</span> <span class="kw">=</span> <span class="no">ensemblID_URL</span>,
                                <span class="kw">p.value</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'P.Value'</span>], <span class="kw">t</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'t'</span>],
                                <span class="kw">p.bonferroni</span> <span class="kw">=</span> <span class="no">limma_out1</span>[<span class="st">'adj.P.Val'</span>], <span class="kw">p.BH</span> <span class="kw">=</span> <span class="no">limma_out2</span>[<span class="st">'adj.P.Val'</span>])

<span class="no">columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'probeID'</span>, <span class="st">'symbol'</span>, <span class="st">'entrezID'</span>, <span class="st">'ensembl'</span>, <span class="st">'p.value'</span>, <span class="st">'t'</span>, <span class="st">'p.bonferroni'</span>, <span class="st">'p.BH'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">limma_gene_pvalues</span>) <span class="kw">=</span> <span class="no">columns</span>

<span class="no">limma_gene_pvalues</span></pre></body></html></div>
<p>Una vez creado el data.frame, elaboramos el informe con la herramienta ReportingTools:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">foutput</span> <span class="kw">=</span> <span class="st">'gse69762_limma.report'</span>
<span class="no">htmlRep1</span> <span class="kw">=</span> <span class="fu">HTMLReport</span>(<span class="kw">shortName</span> <span class="kw">=</span> <span class="no">foutput</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="no">foutput</span>, <span class="kw">reportDirectory</span> <span class="kw">=</span> <span class="st">'./reports'</span>)
<span class="fu">publish</span>(<span class="no">df1</span>,<span class="no">htmlRep1</span>)
<span class="fu">finish</span>(<span class="no">htmlRep1</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Francisco Martinez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
